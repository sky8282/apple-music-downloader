# æ‰¹é‡ä¸‹è½½ä»»åŠ¡å·¥ä½œæµç¨‹éªŒè¯

## ğŸ“‹ æœŸæœ›çš„å·¥ä½œæµç¨‹

```
è¯»å– txt æ–‡ä»¶ 
  â†’ æ¸…ç‚¹é“¾æ¥æ•° 
  â†’ ä¾æ¬¡è¯»å–é“¾æ¥ 
  â†’ ä¸²è¡Œä¸‹è½½ 
  â†’ å®Œæˆä¸‹è½½ 
  â†’ ç§»åŠ¨æ–‡ä»¶ 
  â†’ ç»§ç»­ä¸‹è½½ä¸‹ä¸€ä¸ªé“¾æ¥
```

## âœ… å½“å‰å®é™…å®ç°

### 1. è¯»å– TXT æ–‡ä»¶ï¼ˆç¬¬228-252è¡Œï¼‰

```go
func parseTxtFile(filePath string) ([]string, error) {
    fileBytes, err := os.ReadFile(filePath)
    if err != nil {
        return nil, fmt.Errorf("è¯»å–æ–‡ä»¶å¤±è´¥: %v", err)
    }

    lines := strings.Split(string(fileBytes), "\n")
    var urls []string
    for _, line := range lines {
        trimmedLine := strings.TrimSpace(line)
        // è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Šè¡Œï¼ˆä»¥#å¼€å¤´ï¼‰
        if trimmedLine == "" || strings.HasPrefix(trimmedLine, "#") {
            continue
        }
        // æ”¯æŒä¸€è¡Œå¤šä¸ªé“¾æ¥ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
        linksInLine := strings.Fields(trimmedLine)
        for _, link := range linksInLine {
            link = strings.TrimSpace(link)
            if link != "" {
                urls = append(urls, link)
            }
        }
    }
    return urls, nil
}
```

**çŠ¶æ€**ï¼šâœ… **å®Œå…¨ç¬¦åˆ**
- è¯»å–TXTæ–‡ä»¶
- è§£ææ¯ä¸€è¡Œ
- æ”¯æŒç©ºæ ¼åˆ†éš”å¤šé“¾æ¥
- è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š

### 2. æ¸…ç‚¹é“¾æ¥æ•°ï¼ˆç¬¬258-261è¡Œï¼‰

```go
// æ˜¾ç¤ºè¾“å…¥é“¾æ¥ç»Ÿè®¡
if isBatch && len(initialUrls) > 0 {
    core.SafePrintf("ğŸ“‹ åˆå§‹é“¾æ¥æ€»æ•°: %d\n", len(initialUrls))
    core.SafePrintf("ğŸ”„ å¼€å§‹é¢„å¤„ç†é“¾æ¥...\n\n")
}
```

**çŠ¶æ€**ï¼šâœ… **å®Œå…¨ç¬¦åˆ**
- æ˜¾ç¤ºåˆå§‹é“¾æ¥æ€»æ•°
- æç¤ºå¼€å§‹é¢„å¤„ç†

### 3. é¢„å¤„ç†é“¾æ¥ï¼ˆç¬¬263-296è¡Œï¼‰

```go
for _, urlRaw := range initialUrls {
    if strings.Contains(urlRaw, "/artist/") {
        // å¤„ç†æ­Œæ‰‹é¡µé¢ï¼Œå±•å¼€ä¸ºä¸“è¾‘åˆ—è¡¨
        albumArgs, err := api.CheckArtist(urlRaw, artistAccount, "albums")
        finalUrls = append(finalUrls, albumArgs...)
        
        mvArgs, err := api.CheckArtist(urlRaw, artistAccount, "music-videos")
        finalUrls = append(finalUrls, mvArgs...)
    } else {
        // æ™®é€šé“¾æ¥ç›´æ¥æ·»åŠ 
        finalUrls = append(finalUrls, urlRaw)
    }
}
```

**çŠ¶æ€**ï¼šâœ… **ç¬¦åˆä¸”å¢å¼º**
- æ”¯æŒæ­Œæ‰‹é¡µé¢å±•å¼€
- é¢„å¤„ç†åå¾—åˆ°æœ€ç»ˆä»»åŠ¡åˆ—è¡¨

### 4. è®¡ç®—æœ€ç»ˆä»»åŠ¡æ•°ï¼ˆç¬¬303è¡Œï¼‰

```go
totalTasks := len(finalUrls)
```

**çŠ¶æ€**ï¼šâœ… **å®Œå…¨ç¬¦åˆ**

### 5. å†å²è®°å½•è¿‡æ»¤ï¼ˆç¬¬305-350è¡Œï¼‰

```go
// åˆå§‹åŒ–å†å²è®°å½•ç³»ç»Ÿ
if isBatch && taskFile != "" {
    // æ£€æŸ¥å†å²è®°å½•ï¼Œè·å–å·²å®Œæˆçš„URL
    completedURLs, err = history.GetCompletedURLs(taskFile)
    
    // è¿‡æ»¤å·²å®Œæˆçš„URL
    var remainingUrls []string
    for _, url := range finalUrls {
        if completedURLs[url] {
            skippedCount++
        } else {
            remainingUrls = append(remainingUrls, url)
        }
    }
    
    finalUrls = remainingUrls
    totalTasks = len(finalUrls)
}
```

**çŠ¶æ€**ï¼šâœ… **ç¬¦åˆä¸”å¢å¼º**
- è‡ªåŠ¨è·³è¿‡å·²å®Œæˆçš„ä»»åŠ¡
- æ˜¾ç¤ºè·³è¿‡æ•°é‡å’Œå‰©ä½™ä»»åŠ¡æ•°

### 6. æ˜¾ç¤ºä»»åŠ¡ç»Ÿè®¡ï¼ˆç¬¬352-367è¡Œï¼‰

```go
if isBatch {
    core.SafePrintf("\nğŸ“‹ ========== å¼€å§‹ä¸‹è½½ä»»åŠ¡ ==========\n")
    if len(initialUrls) != totalTasks {
        core.SafePrintf("ğŸ“ é¢„å¤„ç†å®Œæˆ: %d ä¸ªé“¾æ¥ â†’ %d ä¸ªä»»åŠ¡\n", len(initialUrls), totalTasks)
    } else {
        core.SafePrintf("ğŸ“ ä»»åŠ¡æ€»æ•°: %d\n", totalTasks)
    }
    core.SafePrintf("âš¡ æ‰§è¡Œæ¨¡å¼: ä¸²è¡Œæ¨¡å¼ \n")
    core.SafePrintf("ğŸ“¦ ä¸“è¾‘å†…å¹¶å‘: ç”±é…ç½®æ–‡ä»¶æ§åˆ¶\n")
    if task != nil {
        core.SafePrintf("ğŸ“œ å†å²è®°å½•: å·²å¯ç”¨\n")
    }
    core.SafePrintf("====================================\n\n")
}
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
ğŸ“‹ ========== å¼€å§‹ä¸‹è½½ä»»åŠ¡ ==========
ğŸ“ ä»»åŠ¡æ€»æ•°: 63
âš¡ æ‰§è¡Œæ¨¡å¼: ä¸²è¡Œæ¨¡å¼ 
ğŸ“¦ ä¸“è¾‘å†…å¹¶å‘: ç”±é…ç½®æ–‡ä»¶æ§åˆ¶
ğŸ“œ å†å²è®°å½•: å·²å¯ç”¨
====================================
```

**çŠ¶æ€**ï¼šâœ… **å®Œå…¨ç¬¦åˆ**

### 7. ä¸²è¡Œä¸‹è½½å¾ªç¯ï¼ˆç¬¬369-397è¡Œï¼‰

```go
// æ‰¹é‡æ¨¡å¼ï¼šä¸²è¡Œæ‰§è¡Œï¼ˆæŒ‰é“¾æ¥é¡ºåºä¾æ¬¡ä¸‹è½½ï¼‰
// ä¸“è¾‘å†…æ­Œæ›²å¹¶å‘æ•°ç”±é…ç½®æ–‡ä»¶æ§åˆ¶ (lossless_downloadthreads ç­‰)
for i, urlToProcess := range finalUrls {
    albumId, albumName, err := processURL(urlToProcess, nil, nil, i+1, totalTasks)
    
    // è®°å½•åˆ°å†å²
    if task != nil && albumId != "" {
        status := "success"
        errorMsg := ""
        if err != nil {
            status = "failed"
            errorMsg = err.Error()
        }
        
        history.AddRecord(history.DownloadRecord{
            URL:        urlToProcess,
            AlbumID:    albumId,
            AlbumName:  albumName,
            Status:     status,
            DownloadAt: time.Now(),
            ErrorMsg:   errorMsg,
        })
    }
    
    // ä»»åŠ¡ä¹‹é—´æ·»åŠ è§†è§‰é—´éš”ï¼ˆæœ€åä¸€ä¸ªä»»åŠ¡ä¸éœ€è¦ï¼‰
    if isBatch && i < len(finalUrls)-1 {
        core.SafePrintf("\n%s\n\n", strings.Repeat("=", 80))
    }
}
```

**å…³é”®ç‚¹**ï¼š
- âœ… ä½¿ç”¨ `for i, urlToProcess := range finalUrls` - **ä¸²è¡Œæ‰§è¡Œ**
- âœ… è°ƒç”¨ `processURL` é€ä¸ªå¤„ç†
- âœ… æ¯ä¸ªä»»åŠ¡å®Œæˆåè®°å½•å†å²
- âœ… ä»»åŠ¡ä¹‹é—´æ·»åŠ è§†è§‰åˆ†éš”

**çŠ¶æ€**ï¼šâœ… **å®Œå…¨ç¬¦åˆä¸²è¡Œæ¨¡å¼**

### 8. å•ä¸ªä»»åŠ¡å¤„ç†ï¼ˆprocessURL, ç¬¬144-217è¡Œï¼‰

```go
func processURL(urlRaw string, semaphore chan struct{}, wg *sync.WaitGroup, currentTask, totalTasks int) (string, string, error) {
    // å¦‚æœæ˜¯æ‰¹é‡æ¨¡å¼ï¼ˆsemaphoreä¸ºnilï¼‰ï¼Œä¸²è¡Œæ‰§è¡Œ
    // å¦‚æœæ˜¯éæ‰¹é‡æ¨¡å¼ï¼Œä½¿ç”¨semaphoreæ§åˆ¶å¹¶å‘
    
    if isBatch {
        core.SafePrintf("ğŸ§¾ [%d/%d] å¼€å§‹å¤„ç†: %s\n", currentTask, totalTasks, urlRaw)
    }
    
    // è§£æURLç±»å‹
    if isMv {
        // å¤„ç†MV
        handleSingleMV(urlRaw)
    } else if isPlaylist {
        // å¤„ç†æ’­æ”¾åˆ—è¡¨
        task.DoPlayList(playlistId, storefront, urlRaw)
    } else if isStation {
        // å¤„ç†ç”µå°
        task.DoStation(stationId, storefront, urlRaw)
    } else {
        // å¤„ç†ä¸“è¾‘/å•æ›²
        err = downloader.Rip(albumId, storefront, urlArg_i, urlRaw)
    }
    
    if isBatch {
        if err != nil {
            core.SafePrintf("âŒ [%d/%d] ä»»åŠ¡å¤±è´¥: %s\n", currentTask, totalTasks, urlRaw)
        } else {
            core.SafePrintf("âœ… [%d/%d] ä»»åŠ¡å®Œæˆ: %s\n", currentTask, totalTasks, urlRaw)
        }
    }
    
    return albumId, albumName, err
}
```

**çŠ¶æ€**ï¼šâœ… **å®Œå…¨ç¬¦åˆ**
- æ˜¾ç¤ºå½“å‰è¿›åº¦ [X/Y]
- å¤„ç†å„ç§ç±»å‹çš„é“¾æ¥
- å®Œæˆåæ˜¾ç¤ºç»“æœ

### 9. ä¸“è¾‘ä¸‹è½½ï¼ˆdownloader.Ripï¼‰

```go
// downloader.Rip å‡½æ•°æµç¨‹ï¼š
1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨ï¼ˆç¬¬776-853è¡Œï¼‰
   - å…¨éƒ¨å­˜åœ¨ â†’ è·³è¿‡ä¸‹è½½ï¼Œç›´æ¥è¿”å›
   - éƒ¨åˆ†å­˜åœ¨ â†’ åªä¸‹è½½ä¸å­˜åœ¨çš„

2. æ‰¹æ¬¡ä¸‹è½½å¾ªç¯ï¼ˆç¬¬853-1129è¡Œï¼‰
   - æ¯æ‰¹æ­Œæ›²å¹¶å‘ä¸‹è½½ï¼ˆé…ç½®æ–‡ä»¶æ§åˆ¶çº¿ç¨‹æ•°ï¼‰
   - ä¸‹è½½åˆ°ç¼“å­˜è·¯å¾„
   - å®ŒæˆåŠ å·¥ï¼ˆFFmpegã€æ ‡ç­¾ï¼‰
   
3. æ‰¹æ¬¡å®Œæˆåè½¬ç§»æ–‡ä»¶ï¼ˆç¬¬1078-1127è¡Œï¼‰
   - å¤šæ‰¹æ¬¡ä¸”ä¸æ˜¯æœ€åä¸€æ‰¹ â†’ ç«‹å³è½¬ç§»
   - æ£€æŸ¥ç›®æ ‡æ–‡ä»¶å­˜åœ¨æ€§
   - åªè½¬ç§»æ–°æ–‡ä»¶ï¼Œä¸è¦†ç›–å·²æœ‰æ–‡ä»¶
   
4. æ‰€æœ‰æ‰¹æ¬¡å®Œæˆåæœ€ç»ˆè½¬ç§»ï¼ˆç¬¬1150-1215è¡Œï¼‰
   - é€’å½’æ‰«æç¼“å­˜
   - è½¬ç§»æ‰€æœ‰å‰©ä½™æ–‡ä»¶
   - æ£€æŸ¥å¹¶è·³è¿‡å·²å­˜åœ¨æ–‡ä»¶
   - æ˜¾ç¤ºç»Ÿè®¡ï¼šã€Œæ–°å¢ X ä¸ªï¼Œè·³è¿‡ Y ä¸ªã€
   
5. æ¸…ç†ç¼“å­˜ï¼ˆç¬¬1217-1220è¡Œï¼‰
   - åˆ é™¤ç¼“å­˜hashç›®å½•
```

**çŠ¶æ€**ï¼šâœ… **å®Œå…¨ç¬¦åˆ**
- ä¸‹è½½åˆ°ç¼“å­˜
- å®ŒæˆåŠ å·¥
- è½¬ç§»æ–‡ä»¶
- æ¸…ç†ç¼“å­˜

### 10. ä¿å­˜å†å²è®°å½•ï¼ˆç¬¬400-407è¡Œï¼‰

```go
// ä¿å­˜ä»»åŠ¡å†å²
if task != nil {
    if err := history.SaveTask(task); err != nil {
        core.SafePrintf("\nâš ï¸  ä¿å­˜å†å²è®°å½•å¤±è´¥: %v\n", err)
    } else {
        core.SafePrintf("\nğŸ“œ å†å²è®°å½•å·²ä¿å­˜è‡³: history/%s.json\n", task.TaskID)
    }
}
```

**çŠ¶æ€**ï¼šâœ… **å®Œå…¨ç¬¦åˆ**

## ğŸ“Š å®Œæ•´å·¥ä½œæµç¨‹éªŒè¯

### æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¯»å– TXT æ–‡ä»¶ (parseTxtFile)                              â”‚
â”‚    - è§£ææ¯ä¸€è¡Œ                                               â”‚
â”‚    - æ”¯æŒç©ºæ ¼åˆ†éš”å¤šé“¾æ¥                                       â”‚
â”‚    - è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ¸…ç‚¹é“¾æ¥æ•°                                                â”‚
â”‚    ğŸ“‹ åˆå§‹é“¾æ¥æ€»æ•°: 63                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. é¢„å¤„ç†é“¾æ¥ï¼ˆå±•å¼€æ­Œæ‰‹é¡µé¢ç­‰ï¼‰                              â”‚
â”‚    ğŸ”„ å¼€å§‹é¢„å¤„ç†é“¾æ¥...                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å†å²è®°å½•è¿‡æ»¤                                              â”‚
â”‚    ğŸ“œ å†å²è®°å½•æ£€æµ‹: å‘ç° 5 ä¸ªå·²å®Œæˆçš„ä»»åŠ¡                    â”‚
â”‚    â­ï¸  å·²è‡ªåŠ¨è·³è¿‡ï¼Œå‰©ä½™ 58 ä¸ªä»»åŠ¡                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ˜¾ç¤ºä»»åŠ¡ç»Ÿè®¡                                              â”‚
â”‚    ğŸ“‹ ========== å¼€å§‹ä¸‹è½½ä»»åŠ¡ ==========                     â”‚
â”‚    ğŸ“ ä»»åŠ¡æ€»æ•°: 58                                           â”‚
â”‚    âš¡ æ‰§è¡Œæ¨¡å¼: ä¸²è¡Œæ¨¡å¼                                      â”‚
â”‚    ğŸ“¦ ä¸“è¾‘å†…å¹¶å‘: ç”±é…ç½®æ–‡ä»¶æ§åˆ¶                             â”‚
â”‚    ğŸ“œ å†å²è®°å½•: å·²å¯ç”¨                                       â”‚
â”‚    ====================================                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  ä¸²è¡Œä¸‹è½½å¾ªç¯ï¼ˆfor i, urlï¼‰ â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. å¤„ç†ç¬¬ 1 ä¸ªé“¾æ¥                                           â”‚
â”‚    ğŸ§¾ [1/58] å¼€å§‹å¤„ç†: https://...                          â”‚
â”‚    â”œâ”€ è§£æURLç±»å‹                                            â”‚
â”‚    â”œâ”€ è°ƒç”¨ downloader.Rip                                    â”‚
â”‚    â”‚  â”œâ”€ æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨                                  â”‚
â”‚    â”‚  â”œâ”€ ä¸‹è½½åˆ°ç¼“å­˜ï¼ˆä¸“è¾‘å†…å¹¶å‘ï¼‰                            â”‚
â”‚    â”‚  â”œâ”€ å®ŒæˆåŠ å·¥ï¼ˆFFmpegã€æ ‡ç­¾ï¼‰                            â”‚
â”‚    â”‚  â”œâ”€ æ‰¹æ¬¡å®Œæˆåè½¬ç§»æ–‡ä»¶                                  â”‚
â”‚    â”‚  â”œâ”€ æœ€ç»ˆè½¬ç§»å‰©ä½™æ–‡ä»¶                                    â”‚
â”‚    â”‚  â”‚  ğŸ“¥ æ–‡ä»¶è½¬ç§»å®Œæˆï¼ï¼ˆæ–°å¢ 36 ä¸ªï¼Œè·³è¿‡ 0 ä¸ªï¼‰          â”‚
â”‚    â”‚  â””â”€ æ¸…ç†ç¼“å­˜                                            â”‚
â”‚    â”œâ”€ è®°å½•å†å²                                               â”‚
â”‚    â””â”€ âœ… [1/58] ä»»åŠ¡å®Œæˆ                                     â”‚
â”‚                                                              â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                 â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. å¤„ç†ç¬¬ 2 ä¸ªé“¾æ¥                                           â”‚
â”‚    ğŸ§¾ [2/58] å¼€å§‹å¤„ç†: https://...                          â”‚
â”‚    â”œâ”€ ... (åŒä¸Š) ...                                         â”‚
â”‚    â””â”€ âœ… [2/58] ä»»åŠ¡å®Œæˆ                                     â”‚
â”‚                                                              â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
                        ...
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. å¤„ç†ç¬¬ 58 ä¸ªé“¾æ¥ï¼ˆæœ€åä¸€ä¸ªï¼‰                              â”‚
â”‚    ğŸ§¾ [58/58] å¼€å§‹å¤„ç†: https://...                         â”‚
â”‚    â”œâ”€ ... (åŒä¸Š) ...                                         â”‚
â”‚    â””â”€ âœ… [58/58] ä»»åŠ¡å®Œæˆ                                    â”‚
â”‚    ï¼ˆæœ€åä¸€ä¸ªä»»åŠ¡ä¸æ˜¾ç¤ºåˆ†éš”çº¿ï¼‰                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. ä¿å­˜å†å²è®°å½•                                              â”‚
â”‚    ğŸ“œ å†å²è®°å½•å·²ä¿å­˜è‡³: history/xxx.json                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. æ˜¾ç¤ºç»Ÿè®¡                                                 â”‚
â”‚     ğŸ“¦ å·²å®Œæˆ: 58/58 | è­¦å‘Š: 0 | é”™è¯¯: 0                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… éªŒè¯ç»“æœ

### æœŸæœ›æµç¨‹ vs å®é™…å®ç°

| æ­¥éª¤ | æœŸæœ› | å®é™…å®ç° | çŠ¶æ€ |
|------|------|----------|------|
| 1. è¯»å– txt æ–‡ä»¶ | âœ… | parseTxtFile (ç¬¬228-252è¡Œ) | âœ… **å®Œå…¨ç¬¦åˆ** |
| 2. æ¸…ç‚¹é“¾æ¥æ•° | âœ… | æ˜¾ç¤ºåˆå§‹é“¾æ¥æ€»æ•° (ç¬¬258-261è¡Œ) | âœ… **å®Œå…¨ç¬¦åˆ** |
| 3. ä¾æ¬¡è¯»å–é“¾æ¥ | âœ… | ä¸²è¡Œ for å¾ªç¯ (ç¬¬371è¡Œ) | âœ… **å®Œå…¨ç¬¦åˆ** |
| 4. ä¸²è¡Œä¸‹è½½ | âœ… | æ— å¹¶å‘ï¼Œé€ä¸ªå¤„ç† (ç¬¬371-397è¡Œ) | âœ… **å®Œå…¨ç¬¦åˆ** |
| 5. å®Œæˆä¸‹è½½ | âœ… | processURL â†’ Rip â†’ ä¸‹è½½ | âœ… **å®Œå…¨ç¬¦åˆ** |
| 6. ç§»åŠ¨æ–‡ä»¶ | âœ… | æ‰¹æ¬¡è½¬ç§» + æœ€ç»ˆè½¬ç§» | âœ… **å®Œå…¨ç¬¦åˆ** |
| 7. ç»§ç»­ä¸‹ä¸€ä¸ª | âœ… | for å¾ªç¯è‡ªåŠ¨ç»§ç»­ | âœ… **å®Œå…¨ç¬¦åˆ** |

### é¢å¤–çš„å¢å¼ºåŠŸèƒ½

| åŠŸèƒ½ | æè¿° | ä½ç½® |
|------|------|------|
| **å†å²è®°å½•** | è‡ªåŠ¨è·³è¿‡å·²å®Œæˆä»»åŠ¡ | ç¬¬305-350è¡Œ |
| **é¢„å¤„ç†** | å±•å¼€æ­Œæ‰‹é¡µé¢ä¸ºä¸“è¾‘åˆ—è¡¨ | ç¬¬263-296è¡Œ |
| **è¿›åº¦æ˜¾ç¤º** | [X/Y] æ˜¾ç¤ºå½“å‰è¿›åº¦ | processURL |
| **è§†è§‰åˆ†éš”** | ä»»åŠ¡ä¹‹é—´80ä¸ªç­‰å·åˆ†éš” | ç¬¬393-397è¡Œ |
| **ç»Ÿè®¡åé¦ˆ** | è½¬ç§»æ–‡ä»¶æ—¶æ˜¾ç¤ºæ–°å¢/è·³è¿‡æ•°é‡ | downloader.Rip |
| **å¢é‡ä¸‹è½½** | åªä¸‹è½½ä¸å­˜åœ¨çš„æ–‡ä»¶ | downloader.Rip |
| **æ™ºèƒ½è·³è¿‡** | æ£€æŸ¥ç›®æ ‡æ–‡ä»¶å­˜åœ¨æ€§ï¼Œä¸è¦†ç›– | SafeMoveFile |

## ğŸ¯ å…³é”®ç‰¹æ€§

### 1. çœŸæ­£çš„ä¸²è¡Œæ‰§è¡Œ

```go
// ç¬¬371è¡Œï¼šfor i, urlToProcess := range finalUrls
```
- âœ… ä½¿ç”¨é¡ºåº for å¾ªç¯ï¼Œä¸æ˜¯ goroutine
- âœ… æ¯ä¸ªä»»åŠ¡å®Œå…¨å®Œæˆåæ‰å¼€å§‹ä¸‹ä¸€ä¸ª
- âœ… æ–‡ä»¶è½¬ç§»åœ¨ä»»åŠ¡å†…éƒ¨å®Œæˆ

### 2. æ–‡ä»¶è½¬ç§»æ—¶æœº

**æ—¶æœº1ï¼šæ‰¹æ¬¡è½¬ç§»**ï¼ˆä¸“è¾‘å†…å¤šæ‰¹æ¬¡æ—¶ï¼‰
```
æ‰¹æ¬¡1å®Œæˆ â†’ è½¬ç§»æ‰¹æ¬¡1æ–‡ä»¶ â†’ æ‰¹æ¬¡2ä¸‹è½½ â†’ è½¬ç§»æ‰¹æ¬¡2æ–‡ä»¶
```

**æ—¶æœº2ï¼šæœ€ç»ˆè½¬ç§»**ï¼ˆä¸“è¾‘å®Œæˆæ—¶ï¼‰
```
æ‰€æœ‰æ‰¹æ¬¡å®Œæˆ â†’ è½¬ç§»æ‰€æœ‰å‰©ä½™æ–‡ä»¶ â†’ æ¸…ç†ç¼“å­˜
```

**ç»“æœ**ï¼š
- âœ… æ¯ä¸ªä¸“è¾‘ä¸‹è½½å®Œæˆåï¼Œæ–‡ä»¶ç«‹å³è½¬ç§»åˆ°ç›®æ ‡ä½ç½®
- âœ… æ¸…ç†ç¼“å­˜ï¼Œä¸ç•™æ®‹ç•™
- âœ… ç„¶å for å¾ªç¯è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€ä¸ªé“¾æ¥

### 3. ä¸è¦†ç›–å·²æœ‰æ–‡ä»¶

```go
// SafeMoveFile (helpers.go ç¬¬172-177è¡Œ)
targetExists, _ := FileExists(dst)
if targetExists {
    return fmt.Errorf("ç›®æ ‡æ–‡ä»¶å·²å­˜åœ¨ï¼Œè·³è¿‡")
}
```
- âœ… è½¬ç§»å‰æ£€æŸ¥ç›®æ ‡æ–‡ä»¶
- âœ… å·²å­˜åœ¨åˆ™è·³è¿‡
- âœ… çœŸæ­£çš„å¢é‡ä¸‹è½½

## ğŸ“ å®é™…è¿è¡Œç¤ºä¾‹

```bash
$ ./apple-music-downloader albums.txt

================================================================================
ğŸµ Apple Music Downloader v2.5.2 (experiment/improve-txt-batch-tasks)
ğŸ“… ç¼–è¯‘æ—¶é—´: 2025-10-10 13:11:33 CST
ğŸ”– Gitæäº¤: ee0cc1e
================================================================================

ğŸ“‹ åˆå§‹é“¾æ¥æ€»æ•°: 63
ğŸ”„ å¼€å§‹é¢„å¤„ç†é“¾æ¥...

ğŸ“œ å†å²è®°å½•æ£€æµ‹: å‘ç° 5 ä¸ªå·²å®Œæˆçš„ä»»åŠ¡
â­ï¸  å·²è‡ªåŠ¨è·³è¿‡ï¼Œå‰©ä½™ 58 ä¸ªä»»åŠ¡

ğŸ“‹ ========== å¼€å§‹ä¸‹è½½ä»»åŠ¡ ==========
ğŸ“ ä»»åŠ¡æ€»æ•°: 58
âš¡ æ‰§è¡Œæ¨¡å¼: ä¸²è¡Œæ¨¡å¼ 
ğŸ“¦ ä¸“è¾‘å†…å¹¶å‘: ç”±é…ç½®æ–‡ä»¶æ§åˆ¶
ğŸ“œ å†å²è®°å½•: å·²å¯ç”¨
====================================

ğŸ§¾ [1/58] å¼€å§‹å¤„ç†: https://music.apple.com/cn/album/...
ğŸ¤ æ­Œæ‰‹: é©¬å‹å‹
ğŸ’½ ä¸“è¾‘: Six Evolutions - Bach: Cello Suites
ğŸ”¬ æ­£åœ¨è¿›è¡Œç‰ˆæƒé¢„æ£€ï¼Œè¯·ç¨å€™...
ğŸ“¡ éŸ³æº: Hi-Res Lossless | 5 çº¿ç¨‹ | CN | 1 ä¸ªè´¦æˆ·å¹¶è¡Œä¸‹è½½
--------------------------------------------------
Track 1 of 36: ... - ä¸‹è½½å®Œæˆ
Track 2 of 36: ... - ä¸‹è½½å®Œæˆ
...
Track 36 of 36: ... - ä¸‹è½½å®Œæˆ
--------------------------------------------------

ğŸ“¤ æ­£åœ¨ä»ç¼“å­˜è½¬ç§»æ–‡ä»¶åˆ°ç›®æ ‡ä½ç½®...
ğŸ“¥ æ–‡ä»¶è½¬ç§»å®Œæˆï¼ï¼ˆæ–°å¢ 36 ä¸ªï¼Œè·³è¿‡ 0 ä¸ªï¼‰

âœ… [1/58] ä»»åŠ¡å®Œæˆ: https://music.apple.com/cn/album/...

================================================================================

ğŸ§¾ [2/58] å¼€å§‹å¤„ç†: https://music.apple.com/cn/album/...
...
âœ… [2/58] ä»»åŠ¡å®Œæˆ: https://music.apple.com/cn/album/...

================================================================================

...

ğŸ§¾ [58/58] å¼€å§‹å¤„ç†: https://music.apple.com/cn/album/...
...
âœ… [58/58] ä»»åŠ¡å®Œæˆ: https://music.apple.com/cn/album/...

ğŸ“œ å†å²è®°å½•å·²ä¿å­˜è‡³: history/albums-20251010-130000.json

ğŸ“¦ å·²å®Œæˆ: 58/58 | è­¦å‘Š: 0 | é”™è¯¯: 0
```

## âœ… æœ€ç»ˆç»“è®º

æ‰¹é‡ä¸‹è½½ä»»åŠ¡çš„å·¥ä½œæµç¨‹**å®Œå…¨ç¬¦åˆ**ç”¨æˆ·æœŸæœ›ï¼š

1. âœ… **è¯»å– txt æ–‡ä»¶** - parseTxtFile å‡½æ•°
2. âœ… **æ¸…ç‚¹é“¾æ¥æ•°** - æ˜¾ç¤ºåˆå§‹é“¾æ¥æ€»æ•°å’Œæœ€ç»ˆä»»åŠ¡æ•°
3. âœ… **ä¾æ¬¡è¯»å–é“¾æ¥** - for å¾ªç¯é¡ºåºéå†
4. âœ… **ä¸²è¡Œä¸‹è½½** - æ— å¹¶å‘ï¼Œé€ä¸ªæ‰§è¡Œ
5. âœ… **å®Œæˆä¸‹è½½** - processURL â†’ Rip å®Œæ•´æµç¨‹
6. âœ… **ç§»åŠ¨æ–‡ä»¶** - æ‰¹æ¬¡è½¬ç§» + æœ€ç»ˆè½¬ç§»ï¼Œæ£€æŸ¥ä¸è¦†ç›–
7. âœ… **ç»§ç»­ä¸‹ä¸€ä¸ª** - for å¾ªç¯è‡ªåŠ¨è¿›å…¥ä¸‹ä¸€æ¬¡è¿­ä»£

**é¢å¤–ä¼˜åŠ¿**ï¼š
- âœ… å†å²è®°å½•è‡ªåŠ¨è·³è¿‡å·²å®Œæˆä»»åŠ¡
- âœ… å¢é‡ä¸‹è½½ï¼Œåªä¸‹è½½ä¸å­˜åœ¨çš„æ–‡ä»¶
- âœ… æ™ºèƒ½è½¬ç§»ï¼Œä¸è¦†ç›–å·²æœ‰æ–‡ä»¶
- âœ… æ¸…æ™°çš„è¿›åº¦æ˜¾ç¤ºå’Œç»Ÿè®¡åé¦ˆ

